<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ez.gw.employee.model.EmployeeDAO">
	<sql id="searchWhere">
		<where>
			<if test="searchKeyword!=null and searchKeyword!=''">
	   	 		${searchCondition} LIKE '%'|| #{searchKeyword} ||'%'
	      	</if>
	    </where>
	</sql>
	
	<select id="selectByEmpNo" parameterType="int" resultType="employeeVo">
		select * from employee
		where emp_no=#{empNo}
	</select>
	
	<select id="selectAllEmp" resultType="employeeVo">
		select * from employee
	</select>
	
	<select id="selectPwd" resultType="string" parameterType="int">
		select pwd from employee 
		where emp_no=#{empNo}
	</select>
	
	<select id="selctAuthority" parameterType="int" resultType="string">
		select authority from employee
		where emp_no=#{empNo}
	</select>
	
	<insert id="insertEmp" parameterType="employeeVo">
		<selectKey keyProperty="empNo" order="BEFORE" resultType="int">
			select EMPLOYEE_SEQ.nextval from dual
		</selectKey>
		insert into employee(emp_no, name, ename, jumin, email, pwd, extension_no, tel, address, 
			addressdetail, hiredate, authority, annual_salary, image, position_no, dept_no)
		values(#{empNo},#{name},#{ename},#{jumin,jdbcType=VARCHAR},
			#{email},#{pwd},#{extensionNo},#{tel},#{address},#{addressdetail},
			#{hiredate},#{authority},#{annualSalary},#{image},#{positionNo},#{deptNo})
	</insert>
	
	<select id="selectSearchEmp" parameterType="searchVo" resultType="map">
			select * from organizationChartView
		<if test="searchKeyword!=null and searchKeyword!=''">
			where name like '%'|| #{searchKeyword} ||'%'
			or emp_no like '%'|| #{searchKeyword} ||'%'
			or dept_name like '%'|| #{searchKeyword} ||'%'
			or position_name like '%'|| #{searchKeyword} ||'%'
			and retiredate is null
		</if>
			order by dept_name asc, position_name desc
	</select>
	
	<select id="selectSerachEmp2" parameterType="searchVo" resultType="map">
		select *
		from
		(
			select rownum as rnum, A.*
			from
			(
				select * from organizationChartView
				<include refid="searchWhere"/>
				order by dept_name desc		
			)A
		)
		<![CDATA[
		where rnum > #{firstRecordIndex}
		and rnum <=  #{firstRecordIndex}+ #{recordCountPerPage}
		]]>
	</select>
	
	<select id="getTotalRecord" parameterType="searchVo" resultType="int">
		select count(*) from organizationChartView
        <include refid="searchWhere"></include>
	</select>
	
	<select id="selectEmpByEmpNo" parameterType="int" resultType="map">
		select * from organizationChartView
		where emp_no=#{empNo}
	</select>
	
	<update id="updateEmpInfo" parameterType="employeeVo">
    update employee
    set address=#{address}, addressdetail=#{addressdetail},
        tel=#{tel}, email=#{email}, married=#{married}
    where emp_no=#{empNo}
	</update>
	
	<update id="updateEmpPwd" parameterType="employeeVo">
	    update employee
	    set pwd=#{pwd}
	    where emp_no=#{empNo}
	</update>
	
</mapper>