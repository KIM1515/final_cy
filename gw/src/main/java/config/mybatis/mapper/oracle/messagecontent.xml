<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ez.gw.messagecontent.model.MessageContentDAO">
	<insert id="insertMessage" parameterType="messageContentVo">
		<selectKey keyProperty="messageNo" resultType="int" order="BEFORE">
			select message_content_seq.nextval from dual
		</selectKey>
		insert into message_content(message_no,message_content,emp_no)
		values(#{messageNo},#{messageContent},#{empNo})
	</insert>
	
	<select id="selectAllReader" parameterType="int" resultType="int">
		select distinct reader from messageView m
		where emp_no = #{empNo}
	</select>
	
	<select id="selectLastMessageByReader" parameterType="messageViewVo" resultType="messageViewVo">
		select rownum, A.* from
		(
		    select * from messageView m
		    where (emp_no =#{empNo} or reader=#{empNo})
   			and (reader=#{reader} or emp_no =#{reader})
		    order by send_date desc
		)A
		where rownum=1
	</select>

</mapper>