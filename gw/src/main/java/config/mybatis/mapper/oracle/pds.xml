<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ez.gw.pds.model.PdsDAO">
	<insert id="insertPds" parameterType="boardVo">
		<selectKey keyProperty="boardNo" order="BEFORE" resultType="int">
			select board_seq.nextval from dual
		</selectKey>
			
		insert into board(board_no, emp_no, boardList_no, title, content)
		values(#{boardNo}, #{empNo}, 3000, #{title}, #{content})
	</insert>
	
<select id="selectPdsAll" resultType="map" parameterType="searchVo">
    select *
    from
    (
        select rownum as RNUM, A.* from
        (
            select 
            boardList_no, board_no, emp_no, name, title, content, readcount, regdate
            from pdsListview
            where boardList_no=3000
            <if test="searchKeyword!=null and searchKeyword!=''">
                <choose>
                    <when test="searchCondition == 'total'">
                        and (title like '%' || #{searchKeyword} || '%' or content like '%' || #{searchKeyword} || '%')
                    </when>
                    <otherwise>
                        and ${searchCondition} like '%' || #{searchKeyword} || '%'
                    </otherwise>
                </choose>
            </if>
            order by board_no desc
        ) A
    )
    <![CDATA[
    where RNUM > #{firstRecordIndex} 
    and RNUM <= #{firstRecordIndex} + #{recordCountPerPage}
    ]]>
</select>
	
<select id="getTotalRecord" parameterType="searchVo" resultType="int">
    select count(*)
    from pdsListview
    where boardList_no = 3000
    <if test="searchKeyword!=null and searchKeyword!=''">
        <choose>
            <when test="searchCondition == 'total'">
                and (title like '%' || #{searchKeyword} || '%' or content like '%' || #{searchKeyword} || '%')
            </when>
            <otherwise>
                and ${searchCondition} like '%' || #{searchKeyword} || '%'
            </otherwise>
        </choose>
    </if>
</select>
	
	
	<select id="selectPds" parameterType="int" resultType="map">
		select * from pdsListView
		where board_no=#{boardNo} and boardList_no = 3000
	</select>
	
	<update id="updatePds" parameterType="boardVo">
		update board
		set title=#{title}, content=#{content}
		where boardList_no=3000 and board_No=#{boardNo}
	</update>
	
	<delete id="deletePds" parameterType="int">
		delete from board
		where board_No=#{boardNo}
	</delete>
	
	<delete id="deletePdsFile" parameterType="int">
		delete pds
		where boardList_no=3000 and board_no=#{boardNo}
	</delete>
	
	<delete id="editPdsFile" parameterType="map">
		delete pds
		where boardList_no=3000 and board_no=#{boardNo}
		<if test="oldFileName!=null and oldFileName!=''">
			and fileName=#{oldFileName}
		</if>
	</delete>
	
	<insert id="insertFiles" parameterType="pdsVo">
		<selectKey keyProperty="pdsNo" order="BEFORE" resultType="int">
			select pds_seq.nextval from dual
		</selectKey>
		
		insert into pds(pds_no, path, fileName, fileSize, originalfileName, file_extension,
			 boardList_no, board_no)
		values(#{pdsNo}, #{path}, #{fileName}, #{fileSize}, #{originalFileName}, #{fileExtension},
			#{boardListNo}, #{boardNo})
	</insert>
	
	<select id="selectFilesByBoardNo" parameterType="int" resultType="pdsVo">
		select * from pds
		where boardList_no=3000 and board_no=#{boardNo}
	</select>
	
	<update id="updateDownloadCount" parameterType="int">
		update pds
		set downloadCount = downloadCount + 1
		where board_no=#{boardNo}
	</update>
	
	<select id="selectIsFile" parameterType="int" resultType="int">
		select count(*) from pds
		where board_no = #{boardNo}
	</select>

</mapper>