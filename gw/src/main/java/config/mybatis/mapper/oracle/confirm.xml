<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ez.gw.confirm.model.ConfirmDAO">
	<sql id="searchWhere">
		<where>
			emp_no=#{empNo}
			<if test="confirmDocumentNo!=null and confirmDocumentNo!=''">
				and confirm_document_no like '%' || #{confirmDocumentNo} || '%'
			</if>
			<if test="confirmTitle!=null and confirmTitle!=''">
				and confirm_title like '%' || #{confirmTitle} || '%'
			</if>
			<if test="documentNo!=null and documentNo!=''">
				and document_no = #{documentNo}
			</if>
			<if test="confirmState!=null and confirmState!=''">
				and confirm_state = #{confirmState}
			</if>
			<if test="createDate!=null and createDate!=''">
				and trunc(create_date) = #{createDate}
			</if>
			<if test="startDate!=null and startDate!=''">
				and trunc(start_date) = #{startDate}
			</if>
			<if test="endDate!=null and endDate!=''">
				and trunc(end_date) = #{endDate}
			</if>
		</where>	
	</sql>
	<select id="selectCountByDate" resultType="int">
		select count(*) from confirm
		where trunc(create_date) = trunc(sysdate)
	</select>
	
	<insert id="insertConfirm" parameterType="confirmVo">
		insert into confirm(confirm_document_no,confirm_title,confirm_content,emp_no,confirm_line_no,document_no,start_date,end_date)
		values(#{confirmDocumentNo},#{confirmTitle},#{confirmContent},#{empNo},#{confirmLineNo},#{documentNo},#{startDate},#{endDate})
	</insert>
	
	<select id="selectAllByEmpNo" parameterType="confirmVo" resultType="map">
		select * from
			(
			select rownum as num, A.* from
				(
					select * from confirmsview
					<include refid="searchWhere"></include>
				)A
			)
		<![CDATA[
		where num>#{firstRecordIndex} 
		and num<=#{firstRecordIndex}+#{recordCountPerPage} ]]>
	</select>
	
	<select id="getTotalRecord" parameterType="confirmVo" resultType="int">
		select count(*) from confirmsview 
		<include refid="searchWhere"></include>
	</select>
</mapper>